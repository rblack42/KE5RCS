

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Gateway Software Install Script &mdash; D-Star Notes</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="D-Star Notes" href="../index.html"/>
        <link rel="next" title="Voice and Data Packets" href="../Protocol/Packets.html"/>
        <link rel="prev" title="Gateway DNS Setup" href="../GatewayServer/DNSInstall.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> D-Star Notes
          

          
            
            <img src="../_static/dstar.jpg" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">D-Star Notes: Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../DstarComponents.html">D_Star Repeater Components</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Network/RouterSetup.html">Configuring a Second Linksys Router</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Network/NetworkSetup.html">Gateway Network Setup</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../GatewayServer/InstallSummary.html">Summary of Build Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GatewayServer/BootMedia.html">Preparing Boot Media</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GatewayServer/CentOS_install.html">Installing CentOS for D-Star</a></li>
<li class="toctree-l1"><a class="reference internal" href="../GatewayServer/DNSInstall.html">Gateway DNS Setup</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Gateway Software Install Script</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#script-structure">Script Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#check-function">Check Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#unpack-dsinst-files">Unpack <code class="docutils literal"><span class="pre">dsinst</span></code> files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-the-gcc-is-installed">Check the <code class="docutils literal"><span class="pre">gcc</span></code> is installed</a></li>
<li class="toctree-l3"><a class="reference internal" href="#verify-that-named-is-installed">Verify that <code class="docutils literal"><span class="pre">named</span></code> is installed:</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-for-running-d-star-processes">Check for running D-Star Processes</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#install-function">Install Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialization">Initialization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#create-dstar-group-and-user">Create <code class="docutils literal"><span class="pre">dstar</span></code> Group and User</a></li>
<li class="toctree-l2"><a class="reference internal" href="#install-postgress">Install Postgress</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuring-the-dstar-account">Configuring the <code class="docutils literal"><span class="pre">dstar</span></code> Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-the-postgres-account">Configure the <code class="docutils literal"><span class="pre">postgres</span></code> account</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Protocol/Packets.html">Voice and Data Packets</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../Appendix/CentOS_VM.html">CentOS 5.11 VM Install</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">D-Star Notes</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Gateway Software Install Script</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/G2Software/GatewayInstall.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="gateway-software-install-script">
<h1>Gateway Software Install Script<a class="headerlink" href="#gateway-software-install-script" title="Permalink to this headline">¶</a></h1>
<p>The script provided with the <a class="reference external" href="http://www.icomamerica.com/en/amateur/">Icom</a> software is a huge file with over 100 steps.
The script is fairly easy to run, but it has features that are a bit
old-fashioned in today’s world. To make sure I understood what was happening as
this script runs, I decided to break it up and look at each of the steps. This
note is the result of that study.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This script needs to be run while logged in as the <cite>root</cite> user.</p>
<div class="last highlight-bash"><div class="highlight"><pre><span></span>$ ssh &lt;server-ip-address&gt;
$ sudo su -
&lt;enter sudo user password&gt;
<span class="c1"># cd /home/n5ujh/dstar/RS-RP2C</span>
./dstar_gw-install
</pre></div>
</div>
</div>
<div class="section" id="script-structure">
<h2>Script Structure<a class="headerlink" href="#script-structure" title="Permalink to this headline">¶</a></h2>
<p>The script is set up as three major function, and a main routine that files up
things as needed.</p>
<p>The main routine is found at the end of the script (at line 1585. The first
thing it does is run the <code class="docutils literal"><span class="pre">check</span></code> function, which examines the running system
to see if installation can proceed.</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1584
1585
1586
1587
1588
1589
1590
1591
1592
1593</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
###### main() ######

##start check
check
if [ $? != 0 ];then
	echo &quot;*** install failed. *** (100.1)&quot; | tee -a ~/dstar_gw-install.log
	exit
else
	true
</pre></div>
</td></tr></table></div>
<p>Following this check, the script looks for options that control what happens.
You can either <code class="docutils literal"><span class="pre">install</span></code> or <code class="docutils literal"><span class="pre">uninstall</span></code> the <a class="reference external" href="http://www.icomamerica.com/en/amateur/">Icom</a> D-Star software using this
script. By default, it runs <code class="docutils literal"><span class="pre">install</span></code></p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1596
1597
1598
1599
1600
1601
1602
1603
1604
1605
1606
1607
1608
1609
1610
1611
1612
1613
1614
1615
1616
1617
1618
1619
1620
1621
1622
1623
1624
1625
1626
1627
1628
1629
1630
1631
1632
1633
1634
1635
1636
1637
1638
1639
1640
1641
1642
1643
1644
1645
1646
1647
1648
1649
1650
1651
1652
1653
1654</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
###101-105 Option ###

case $1 in
	uninstall)	echo &quot;Do you really want to uninstall? (Y/n)&quot;
				read ans
				case ${ans} in
					[yY])	uninstall
							echo &quot;*** uninstall successfully finished. ***&quot;;;
					*)	;;	
				esac
				;;
	install)	install
				if [ $? != 0 ];then
					echo &quot;*** install failed. *** (101)&quot; | tee -a ~/dstar_gw-install.log
					pkill postgres
					echo &quot;Do you want to uninstall? (Y/n)&quot;
					read ans
					case ${ans} in
						[yY])	uninstall;;
						*)	;;	
					esac
				else
					echo &quot;*** install successfully finished. *** (102)&quot; | tee -a ~/dstar_gw-install.log
					echo &quot;Do you want to append an administrator? (Y/n)&quot;
					read ans
					case ${ans} in
						[yY])	add_user_mng.sh;;
						*)	;;	
					esac
					pkill postgres
					echo &quot;Please edit &#39;GW server&#39; conf&quot;
				fi
				;;
	&quot;&quot;)			install
				if [ $? != 0 ];then
					echo &quot;*** install failed. *** (103)&quot; | tee -a ~/dstar_gw-install.log
					pkill postgres
					echo &quot;Do you want to uninstall? (Y/n)&quot;
					read ans
					case ${ans} in
						[yY])	uninstall;;
						*)	;;	
					esac
				else
					echo &quot;*** install successfully finished. *** (104)&quot; | tee -a ~/dstar_gw-install.log
					pkill postgres
					echo
					echo
					echo &quot;*******************************************&quot;
					echo &quot;*******Please edit &#39;GW server&#39; conf.*******&quot;
					echo &quot;*******************************************&quot;
					echo
					echo
				fi
				;;
	*)			echo &quot;invalid argument to option (105)&quot; | tee -a ~/dstar_gw-install.log
				;;
esac
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Gateway configuration file mentioned here is located at
<code class="docutils literal"><span class="pre">/opt/products/dstar/dstar_gw/dsgwd/dsgwd.conf</span></code>. Details on that file are
included elsewhere.</p>
</div>
<p>Notice that if the install fails, the script will let you try to <code class="docutils literal"><span class="pre">uninstall</span></code>
whatever managed to get installed.</p>
<p>Finally, temporary files created by the install procedure are removed.</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1657
1658
1659
1660
1661
1662
1663
1664
1665
1666
1667
1668</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#106 delete temporary files
if [ -d /tmp/dsinst ];
then
	rm -rf /tmp/dsinst
	if [ $? != 0 ];then
		echo &quot;error:Failed to remove temporary files (106)&quot;| tee -a ~/dstar_gw-install.log
	else
		true
	fi
else
	true
fi
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="check-function">
<h2>Check Function<a class="headerlink" href="#check-function" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">check</span></code> function examines the system to see if D-Star processes are
running, and if files are already in place.</p>
<p>The first thing the script does is make sure you are running as the <code class="docutils literal"><span class="pre">root</span></code>
user:</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1350
1351
1352
1353
1354
1355
1356
1357
1358
1359
1360
1361</pre></div></td><td class="code"><div class="highlight"><pre><span></span>###### check() ######
check()
{
### 環境チェック ###

#84 whoami
if [ `whoami` != &#39;root&#39; ];then
	echo &quot;error: not root (84)&quot; | tee -a ~/dstar_gw-install.log
	return 1
else
	true	
fi
</pre></div>
</td></tr></table></div>
<p>Next, we look for temporary files, and delete them if found:</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1370
1371
1372
1373
1374
1375
1376
1377
1378
1379
1380
1381</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#84.2 emove temporary files&#39;/tmp/dsinst&#39;
if [ -d /tmp/dsinst ];
then
	rm -rf /tmp/dsinst
	if [ $? != 0 ];then
		echo &quot;error:Failed to remove temporary files (84.2)&quot;| tee -a ~/dstar_gw-install.log
	else
		true
	fi
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="section" id="unpack-dsinst-files">
<h3>Unpack <code class="docutils literal"><span class="pre">dsinst</span></code> files<a class="headerlink" href="#unpack-dsinst-files" title="Permalink to this headline">¶</a></h3>
<p>We will copy a <code class="docutils literal"><span class="pre">tar</span></code> file containing a number of files that need to be
installed into a temporary directory and unpack them:</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1413
1414
1415
1416
1417
1418
1419
1420
1421
1422
1423
1424
1425
1426
1427
1428
1429
1430
1431
1432
1433
1434
1435
1436
1437
1438
1439
1440
1441
1442
1443</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#84.3 copy &#39;./dsinst.tar.gz&#39; to &#39;/tmp&#39;
cp dsinst.tar.gz /tmp
if [ $? != 0 ];then
	echo &quot;error:Failed to copy &#39;./dsinst.tar.gz&#39; to &#39;/tmp&#39; (84.3)&quot;| tee -a ~/dstar_gw-install.log
else
	true
fi

#84.4 expand files from /tmp/dsinst.tar.gz
gunzip /tmp/dsinst.tar.gz
if [ $? != 0 ];then
	echo &quot;error:Failed to expand files from /tmp/dsinst.tar.gz (84.4)&quot;| tee -a ~/dstar_gw-install.log
else
	true
fi

#84.5 xpand files from /tmp/dsinst.tar
tar -C /tmp -xvf /tmp/dsinst.tar 1&gt;/dev/null
if [ $? != 0 ];then
	echo &quot;error:Failed to expand files from /tmp/dsinst.tar (84.5)&quot;| tee -a ~/dstar_gw-install.log
else
	true
fi

#84.6 remove /tmp/dsinst.tar
rm -f /tmp/dsinst.tar
if [ $? != 0 ];then
	echo &quot;error:Failed to remove /tmp/dsinst.tar (84.6)&quot;| tee -a ~/dstar_gw-install.log
else
	true
fi
</pre></div>
</td></tr></table></div>
<p>In the next section, we verify that needed files are ready to be copied from
the temporary directory:</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1415
1416
1417
1418
1419
1420
1421
1422
1423
1424
1425
1426
1427
1428
1429
1430
1431
1432
1433
1434
1435
1436
1437
1438
1439
1440
1441
1442
1443
1444
1445
1446
1447
1448
1449
1450
1451
1452
1453
1454
1455
1456
1457
1458
1459
1460
1461
1462
1463
1464
1465
1466
1467
1468
1469
1470</pre></div></td><td class="code"><div class="highlight"><pre><span></span>## file-check
#85 root.bashrc
if [ ! -f /tmp/dsinst/root.bashrc ];then
	echo &quot;error: not found /tmp/dsinst/root.bashrc (85)&quot; | tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi

#86 dstar.bashrc
if [ ! -f /tmp/dsinst/dstar.bashrc ];then
	echo &quot;error: not found /tmp/dsinst/dstar.bashrc (86)&quot; | tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi

#87 postgres.bashrc
if [ ! -f /tmp/dsinst/postgres.bashrc ];then
	echo &quot;error: not found /tmp/dsinst/postgres.bashrc (87)&quot; | tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi

#88 httpd.conf
if [ ! -f /tmp/dsinst/httpd.conf ];then
	echo &quot;error: not found /tmp/dsinst/httpd.conf (88)&quot; | tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi

#89 pgsql.sql
if [ ! -f /tmp/dsinst/pgsql.sql ];then
	echo &quot;error: not found /tmp/dsinst/pgsql.sql (89)&quot; | tee -a ~/dstar_gw-install.log
	return 1
fi

#90 dstar_gw
if [ ! -f /tmp/dsinst/dstar_gw ];then
	echo &quot;eerror: not found /tmp/dsinst/dstar_gw (90)&quot; | tee -a ~/dstar_gw-install.log
	return 1
fi

#91 server.xml
if [ ! -f /tmp/dsinst/server.xml ];then
	echo &quot;eerror: not found /tmp/dsinst/server.xml (91)&quot; | tee -a ~/dstar_gw-install.log
	return 1
fi

#92 syslog.conf.set
if [ ! -f /tmp/dsinst/syslog.conf.set ];then
	echo &quot;eerror: not found /tmp/dsinst/syslog.conf.set (92)&quot; | tee -a ~/dstar_gw-install.log
	return 1
fi
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="check-the-gcc-is-installed">
<h3>Check the <code class="docutils literal"><span class="pre">gcc</span></code> is installed<a class="headerlink" href="#check-the-gcc-is-installed" title="Permalink to this headline">¶</a></h3>
<p>The installation will need to compile a few things, so this check makes sure
the build tools were installed:</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1472
1473
1474
1475
1476
1477
1478
1479
1480
1481
1482
1483</pre></div></td><td class="code"><div class="highlight"><pre><span></span>## check gcc
#93 gcc is not installed -&gt; exit
if [ `rpm -q gcc | grep gcc-[34] | wc -l` = 0 ];then
	echo &quot;*** gcc is not installed *** (93)&quot;  | tee -a ~/dstar_gw-install.log
	return 1
fi

#94 gcc-c++ is not installed -&gt; exit
if [ `rpm -q gcc-c++ | grep gcc-c++-[34] | wc -l` = 0 ];then
	echo &quot;*** gcc is not installed *** (94)&quot;  | tee -a ~/dstar_gw-install.log
	return 1
fi
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="verify-that-named-is-installed">
<h3>Verify that <code class="docutils literal"><span class="pre">named</span></code> is installed:<a class="headerlink" href="#verify-that-named-is-installed" title="Permalink to this headline">¶</a></h3>
<p>The gateway server will run a local DNS server. This tool will manage assigned
IP addresses for all D-Star users.</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1485
1486
1487
1488
1489
1490
1491</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#94.1 check DNS-server
if [ ! -d /var/named ];then
	echo &quot;Please install &#39;DNS server&#39; (94.1)&quot;
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="check-for-running-d-star-processes">
<h3>Check for running D-Star Processes<a class="headerlink" href="#check-for-running-d-star-processes" title="Permalink to this headline">¶</a></h3>
<p>The script checks to see if a number of D-Star processes are running. You will be
asked if you want to stop each of these if they are running:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">dsipsvd</span></code> - ???</li>
<li><code class="docutils literal"><span class="pre">dsgwd</span></code> - primary D-Star application</li>
<li><code class="docutils literal"><span class="pre">httpd</span></code> - Apache web server</li>
<li><code class="docutils literal"><span class="pre">postgres</span></code> - D-Star database server</li>
<li><code class="docutils literal"><span class="pre">tomcat</span></code> - Java Application server</li>
</ul>
</div></blockquote>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1493
1494
1495
1496
1497
1498
1499
1500
1501
1502
1503
1504
1505
1506
1507
1508
1509
1510
1511
1512
1513
1514
1515
1516
1517
1518
1519
1520
1521
1522
1523
1524
1525
1526
1527
1528
1529
1530
1531
1532
1533
1534
1535
1536
1537
1538
1539
1540
1541
1542
1543
1544
1545
1546
1547
1548
1549
1550
1551
1552
1553
1554
1555
1556
1557
1558
1559
1560
1561
1562
1563
1564
1565
1566
1567
1568
1569
1570
1571
1572
1573
1574
1575
1576
1577
1578
1579
1580
1581</pre></div></td><td class="code"><div class="highlight"><pre><span></span>## chekck process
#95 chekck process &#39;dsipsvd&#39;
#   is running -&gt; stop process
if [ `ps -aef | grep dsipsvd | grep -v ipchk.sh | grep -v grep | wc -l` != 0 ];then
	echo &quot;*** dsispd is running. *** (95-1)&quot; | tee -a ~/dstar_gw-install.log
	echo &quot;Do you want to stop? (Y/n)&quot;
	read ans
	case ${ans} in
		[yY])	/tmp/dsinst/dstar_gw stop 1&gt;/dev/null
				;;
		*)		;;
	esac
	if [ `ps -aef | grep dsipsvd | grep -v ipchk.sh | grep -v grep | wc -l` != 0 ];then
		echo &quot;*** Failed to stop dsispd. *** (95-2)&quot; | tee -a ~/dstar_gw-install.log
		return 1
	fi
fi

#96 chekck process &#39;dsgwd&#39;
#   is running -&gt; stop process
if [ `pgrep dsgwd | wc -l` != 0 ];then
	echo &quot;*** GW server(dsgwd) is running *** (96-1)&quot; | tee -a ~/dstar_gw-install.log
	echo &quot;Do you want to stop? (Y/n)&quot;
	read ans
	case ${ans} in
		[yY])	/tmp/dsinst/dstar_gw stop 1&gt;/dev/null
				;;
		*)		;;
	esac
	if [ `pgrep dsgwd | wc -l` != 0 ];then
		echo &quot;*** Failed to stop &#39;GW server&#39;(dsgwd). *** (96-2)&quot; | tee -a ~/dstar_gw-install.log
		return 1
	fi
fi

#97 chekck process &#39;httpd&#39;
#   is running -&gt; stop process
if [ `ps -aef | grep /opt/products/dstar/httpd-2.0.59/bin/httpd | grep -v grep | wc -l` != 0 ];then
	echo &quot;*** Apache(httpd) is running. *** (97-1)&quot; | tee -a ~/dstar_gw-install.log
	echo &quot;Do you want to stop? (Y/n)&quot;
	read ans
	case ${ans} in
		[yY])	/tmp/dsinst/dstar_gw stop 1&gt;/dev/null
				;;
		*)		;;
	esac
	if [ `pgrep -U dstar httpd | wc -l` != 0 ];then
		echo &quot;*** Failed to stop Apache(httpd). *** (97-2)&quot; | tee -a ~/dstar_gw-install.log
		return 1
	fi
fi


#98 chekck process &#39;tomcat&#39;
#   is running -&gt; stop process
if [ `ps -aef | grep tomcat | grep -v grep | wc -l` != 0 ];then
	echo &quot;*** tomcat is running. *** (98-1)&quot; | tee -a ~/dstar_gw-install.log
	echo &quot;Do you want to stop? (Y/n)&quot;
	read ans
	case ${ans} in
		[yY])	/tmp/dsinst/dstar_gw stop 1&gt;/dev/null
				;;
		*)		;;
	esac
	if [ `ps -aef | grep tomcat | grep -v grep | wc -l` != 0 ];then
		echo &quot;*** Failed to stop tomcat. *** (98-2)&quot; | tee -a ~/dstar_gw-install.log
		return 1
	fi
fi

#99 find postgres-user
if [ `id postgres 2&gt;/dev/null | wc -l` != 0 ];then
#   chekck process &#39;PostgreSQL&#39;
#   is running -&gt; stop process
	if [ `ps -U postgres | grep postgres | wc -l` != 0 ];then
		echo &quot;*** PostgreSQL is running. *** (99-1)&quot; | tee -a ~/dstar_gw-install.log
		echo &quot;Do you want to stop? (Y/n)&quot;
		read ans
		case ${ans} in
			[yY])	/tmp/dsinst/dstar_gw stop 1&gt;/dev/null
					;;
			*)		;;
		esac
		if [ `ps -U postgres | grep postgres | wc -l` != 0 ];then
			echo &quot;*** Failed to stop PostgreSQL. *** (99-2)&quot; | tee -a ~/dstar_gw-install.log
			return 1
		fi
	fi
fi
</pre></div>
</td></tr></table></div>
<p>This completes the <code class="docutils literal"><span class="pre">check</span></code> function. If this routine returns with no errors,
it is safe to install the D-Star software.</p>
</div>
</div>
<div class="section" id="install-function">
<h2>Install Function<a class="headerlink" href="#install-function" title="Permalink to this headline">¶</a></h2>
<p>The installation procedure has a large number of steps. The script tries to log
things and back out of errors. The actual work in this script is small compared
to all this error checking. (A modern tool like Ansible would clean this up
immensely!)</p>
<div class="section" id="initialization">
<h3>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h3>
<p>The script begins by check ing to see if the <code class="docutils literal"><span class="pre">/opt/products/</span></code> directory
already exists.  This is the directory where all <a class="reference external" href="http://www.icomamerica.com/en/amateur/">Icom</a> D-Star software is
installed. If that directory exists, the user is asked if they want to
reinstall to software. Answering “yes” will result in the old directory being
renamed with the current date, and the script will proceed to install
everything again.</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#!/bin/sh

# CD-drectory
CDROM=`pwd`

###### install() #######
install(){
## check installed files
#0 find /opt/products -&gt; uninstall
if [ -d /opt/products ];then
	echo &quot;*** find &#39;installed-files(/opt/products)&#39; *** (0)&quot; | tee -a ~/dstar_gw-install.log
	echo &quot;Do you want to backup(/opt/products) and uninstall? (Y/n)&quot;
	echo &quot;(and ReInstall)&quot;
	read ans
	case ${ans} in
		[yY])	DATE=`date +&quot;%y%m%d_%H%M%S&quot;`
				mv -f /opt/products /opt/products.$DATE
				uninstall
				if [ -d /opt/products ];then
					echo &quot;*** backup failed. ***(0-1)&quot;
					return 1
				fi
				echo &quot;*** start reinstall. ***&quot;
				;;
		*)		echo &quot;*** backup failed. ***(0-2)&quot;
				return 1
				;;
	esac
else
	true
fi
</pre></div>
</td></tr></table></div>
<p>Next, we make sure the current directory is the one containing the install
script:</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#0.1 installer exists in current-directory
if [ ! -f ./dstar_gw-install ];then
	echo &quot;** You must do this operation in same directory as &#39;dstar_gw-install&#39; (0.1)&quot; | tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="create-dstar-group-and-user">
<h2>Create <code class="docutils literal"><span class="pre">dstar</span></code> Group and User<a class="headerlink" href="#create-dstar-group-and-user" title="Permalink to this headline">¶</a></h2>
<p>In the next segment, the <code class="docutils literal"><span class="pre">dstar</span></code> group is added. Note that everything done by
this scrit gets logged in <code class="docutils literal"><span class="pre">dstar_gw-install.log</span></code> in the <cite>root</cite> home
directory.</p>
<p>You can check that this step worked by examining the <code class="docutils literal"><span class="pre">/etc/group</span></code> file:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ more /etc/group <span class="p">|</span> grep dstar
dstar:x:501:
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">dstar</span></code> user is created in a similar way:</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#2,3 make user-dstar and password
#    failed: &#39;option -p&#39; -&gt; &#39;passwd&#39;
#    find user-dstar -&gt; delete user, make group-dstar -&gt; back to useradd
#    another-error -&gt; exit
useradd -d /home/dstar -m -g dstar -p &#39;{{ default-dstar-password }}&#39; dstar 2&gt;/dev/null
ExVal=$?
while [ ${ExVal} != 0 ];
do
	case ${ExVal} in
		9)	echo &quot;delete user &#39;dstar&#39;? (Y/n) &quot;
			read ans
			case ${ans} in
				[yY])	mktemp -q /tmp/ds_inst 1&gt;/dev/null
						/tmp/dsinst/disp.sh &amp;
						DATE=`date +&quot;%y%m%d_%H%M%S&quot;`
						cd /home
						tar cfvz dstar.$DATE.tar.gz dstar
						cd -
						userdel -r dstar
						rm -f /tmp/ds_inst
						case $? in
							0)	;;
							12)	echo &quot;can&#39;t remove home directory(2.3-1)&quot;| tee -a ~/dstar_gw-install.log
								rm -rf /home/dstar
								;;
							*)	echo &quot;error:userdel dstar failed. (2,3-2)&quot;| tee -a ~/dstar_gw-install.log
								return 1
								;;
						esac
						groupadd dstar
						if [ $? != 0 ];then
							echo &quot;error:groupadd dstar failed. (2,3-3)&quot;| tee -a ~/dstar_gw-install.log
							return 1
						else
							true
						fi
						;;
				*)		echo &quot;error:useradd dstar failed. (2,3-4)&quot;| tee -a ~/dstar_gw-install.log
						return 1
						;;
			esac
			ans=&quot;&quot;
			;;
		3)	useradd -d /home/dstar -m -g dstar dstar
			if [ $? != 0 ];then
				echo &quot;error:useradd dstar failed. (2,3-5)&quot;| tee -a ~/dstar_gw-install.log
				return 1
			else
				echo &quot;type &#39;dstar123&#39;&quot;
				passwd dstar
				if [ $? != 0 ];then
					echo &quot;error:passwd dstar failed. (2,3-6)&quot;| tee -a ~/dstar_gw-install.log
					return 1
				else
					true
				fi
				break
			fi
			;;
		*)	echo &quot;error:useradd dstar failed. (2,3-7)&quot;| tee -a ~/dstar_gw-install.log
			return 1
			;;
	esac
useradd -d /home/dstar -m -g dstar -p &#39;{{ default-dstar-password }}&#39; dstar
ExVal=$?
done
</pre></div>
</td></tr></table></div>
<p>The check that this succeeded is this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ more /etc/passwd <span class="p">|</span> grep dstar
dstar:x:501:501::/home/dstar:/bin/bash
</pre></div>
</div>
<p>This shows the new users home directory and default shell are set. The password
has been set using a hash provided with the script. This is how the Trust
Server administrators are able to log into the gateway server when needed.
(Note: I removed the hash in this note, and replaced it with a template variable.)</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>120
121
122
123
124
125
126
127
128
129</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#4 make group-postgres
groupadd postgres
case $? in
	0)	;;
	9)	echo &quot;*** Already groupadd postgres. *** (4)&quot;| tee -a ~/dstar_gw-install.log
		;;
	*)	echo &quot;error:groupadd postgres failed. (4)&quot;| tee -a ~/dstar_gw-install.log
		return 1
		;;
esac
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="install-postgress">
<h2>Install Postgress<a class="headerlink" href="#install-postgress" title="Permalink to this headline">¶</a></h2>
<p>The Postgress database is used to manage local D-Star user registration data. SInce most gateways only manage a liited number of users, this seems like a heavyweight solution to manaing this data, but that is what <a class="reference external" href="http://www.icomamerica.com/en/amateur/">Icom</a> went with!</p>
<p>The first segment creates a <code class="docutils literal"><span class="pre">postgress</span></code> group:</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#5,6 make user-dstar and password
#    failed: &#39;option -p&#39; -&gt; &#39;passwd&#39;
#    find user-dstar -&gt; delete user, make group-dstar -&gt; back to useradd
#    another-error -&gt; exit
useradd -d /home/postgres -m -g postgres -p &#39;{{ default-postgres-password }}&#39; postgres
ExVal=$?
while [ ${ExVal} != 0 ];
do
	case ${ExVal} in
		9)	echo &quot;delete user &#39;postgres&#39;? (Y/n) &quot;
			read ans
			case ${ans} in
				[yY])	mktemp -q /tmp/ds_inst 1&gt;/dev/null
						/tmp/dsinst/disp.sh &amp;
						DATE=`date +&quot;%y%m%d_%H%M%S&quot;`
						cd /home
						tar cfvz postgres.$DATE.tar.gz postgres
						cd -
						userdel -r postgres
						rm -f /tmp/ds_inst
						case $? in
							0)	;;
							12)	echo &quot;can&#39;t remove home directory(5,6-1)&quot;| tee -a ~/dstar_gw-install.log
								rm -rf /home/postgres
								;;
							*)	echo &quot;error:userdel dstar failed. (5,6-2)&quot;| tee -a ~/dstar_gw-install.log
								return 1
								;;
						esac
						groupadd postgres
						if [ $? != 0 ];then
							echo &quot;error:groupadd postgres failed. (5,6-3)&quot;| tee -a ~/dstar_gw-install.log
							return 1
						else
							true
						fi
						;;
				*)		echo &quot;error:useradd postgres failed. (5,6-4)&quot;| tee -a ~/dstar_gw-install.log
						return 1
						;;
			esac
			ans=&quot;&quot;
			;;
		3)	useradd -d /home/postgres -m -g postgres postgres
			if [ $? != 0 ];then
				echo &quot;error:useradd postgres failed. (5,6-5)&quot;| tee -a ~/dstar_gw-install.log
				return 1
			else
				passwd postgres
				if [ $? != 0 ];then
					echo &quot;error:passwd postgres failed. (5,6-6)&quot;| tee -a ~/dstar_gw-install.log
					return 1
				else
					true
				fi
				break
			fi
			;;
		*)	echo &quot;error:useradd postgres failed. (5,6-7)&quot;| tee -a ~/dstar_gw-install.log
			return 1
			;;
	esac
useradd -d /home/postgres -m -g postgres -p &#39;{{ default-postgres-password }}&#39; postgres
ExVal=$?
done
</pre></div>
</td></tr></table></div>
<p>Again, we can check that this worked by doing this:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ more /etc/group <span class="p">|</span> grep postgres
postgres:x:502:
</pre></div>
</div>
<p>Next, the <cite>postgres</cite> user is created. This script segment is identical to the one used to greate the <cite>dstar</cite> user. Again, the default password has been removed.</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212</pre></div></td><td class="code"><div class="highlight"><pre><span></span>mktemp -q /tmp/ds_inst 1&gt;/dev/null
/tmp/dsinst/disp.sh &amp;

#6.1 backup /root/.bashrc
if [ -f ~/.bashrc ]
then 
	cp ~/.bashrc ~/.bashrc.old
	if [ $? != 0 ];then
		echo &quot;error: Make &#39;~/.bashrc backup&#39; failed. (6.1)&quot;| tee -a ~/dstar_gw-install.log
		return 1
	else
		true
	fi
else
	true #no backup
fi
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="configuring-the-dstar-account">
<h2>Configuring the <code class="docutils literal"><span class="pre">dstar</span></code> Account<a class="headerlink" href="#configuring-the-dstar-account" title="Permalink to this headline">¶</a></h2>
<p>The <cite>dstar</cite> user account is tuned up a bit for Trust System administrator
access. Before this is done, a temporary backup directory, <code class="docutils literal"><span class="pre">/tmp/ds_inst</span></code> is
created to save files being replaced, in case the script fails. If it does
fail, an attempt is made to restore things to the original configuration.</p>
<p>This first segment backs up the current <code class="docutils literal"><span class="pre">.bashrc</span></code> file:</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>214
215
216
217
218
219
220
221
222
223
224
225
226</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#6.2 backup /home/dstar/.bashrc
if [ -f /home/dstar/.bashrc ]
then
	cp /home/dstar/.bashrc /home/dstar/.bashrc.old
	if [ $? != 0 ];then
		echo &quot;error:Make &#39;/home/dstar/.bashrc&#39; backup failed. (6.2)&quot;| tee -a ~/dstar_gw-install.log
		return 1
	else
		true
	fi
else
	true #no backup
fi
</pre></div>
</td></tr></table></div>
<p>Next, the new file is copied from the <a class="reference external" href="http://www.icomamerica.com/en/amateur/">Icom</a> D-Star files.</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>228
229
230
231
232
233
234
235
236
237
238
239
240</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#6.3 backup /home/postgres/.bashrc
if [ -f /home/postgres/.bashrc ]
then
	cp /home/postgres/.bashrc /home/postgres/.bashrc.old
	if [ $? != 0 ];then
		echo &quot;error:Make &#39;/home/postgres/.bashrc&#39; backup failed. (6.3)&quot;| tee -a ~/dstar_gw-install.log
		return 1
	else
		true
	fi
else
	true #no backup
fi
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="configure-the-postgres-account">
<h2>Configure the <code class="docutils literal"><span class="pre">postgres</span></code> account<a class="headerlink" href="#configure-the-postgres-account" title="Permalink to this headline">¶</a></h2>
<p>We do the same thing for the <code class="docutils literal"><span class="pre">postgres</span></code> user account:</p>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>242
243
244
245
246
247
248
249</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#7 add PATH to root-environment
cat /tmp/dsinst/root.bashrc | tee -a ~/.bashrc
if [ $? != 0 ];then
	echo &quot;error:Concatenate PATH to &#39;~/.bashrc&#39; failed. (7)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>251
252
253
254
255
256
257
258</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#7.1 reload root-environment
source ~/.bashrc
if [ $? != 0 ];then
	echo &quot;error:Failed to &#39;source ~/.bashrc&#39;. (7.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>260
261
262
263
264
265
266
267</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#8 add PATH to dstar-environment
cat /tmp/dsinst/dstar.bashrc | tee -a /home/dstar/.bashrc
if [ $? != 0 ];then
	echo &quot;error:Concatenate PATH to &#39;/home/dstar/.bashrc&#39; failed. (8)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>269
270
271
272
273
274
275
276</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#9 add PATH to postgres-environment
cat /tmp/dsinst/postgres.bashrc | tee -a /home/postgres/.bashrc
if [ $? != 0 ];then
	echo &quot;error:Concatenate PATH to &#39;/home/postgres/.bashrc&#39; failed. (9)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>278
279
280
281
282
283
284
285</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#10 copy CD-ROM/apl to /home/dstar/
cp -R ${CDROM}/apl /home/dstar/
if [ $? != 0 ];then
	echo &quot;error:Copy &#39;&quot;${CDROM}&quot;/apl&#39; to &#39;/home/dstar/&#39; failed. (10)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>287
288
289
290
291
292
293
294</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#11 copy CD-ROM/DDL to /home/dstar/
cp -R ${CDROM}/DDL /home/dstar/
if [ $? != 0 ];then
	echo &quot;error:Copy &#39;&quot;${CDROM}&quot;/DDL&#39; to &#39;/home/dstar/&#39; failed. (11)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>296
297
298
299
300
301
302
303</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#12 copy CD-ROM/middle to /home/dstar/
cp -R ${CDROM}/middle /home/dstar/
if [ $? != 0 ];then
	echo &quot;error:Copy &#39;&quot;${CDROM}&quot;/middle&#39; to &#39;/home/dstar/&#39; failed. (12)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>305
306
307
308
309
310
311
312</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#13 copy CD-ROM/rpm to /home/dstar/</span>
<span class="c1">#cp -R ${CDROM}/rpm /home/dstar/</span>
<span class="c1">#if [ $? != 0 ];then</span>
<span class="c1">#	echo &quot;error:Copy &#39;&quot;${CDROM}&quot;/rpm&#39; to &#39;/home/dstar/&#39; failed. (13)&quot;| tee -a ~/dstar_gw-install.log</span>
<span class="c1">#	return 1</span>
<span class="c1">#else</span>
<span class="c1">#	true</span>
<span class="c1">#fi</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>314
315
316
317
318
319
320
321</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#14 change /home/dstar/* owner and group
chown -R dstar:dstar /home/dstar/*
if [ $? != 0 ];then
	echo &quot;error:Change &#39;/home/dstar/*&#39; owner and group failed. (14)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#15 make directories: /opt/products
mkdir /opt/products
if [ $? != 0 ];then
	echo &quot;error:Make &#39;/opt/products&#39; failed. (15)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi

#16 make directories: /opt/products/dstar/openssl-0.9.8d
mkdir /opt/products/dstar
if [ $? != 0 ];then
	echo &quot;error:Make &#39;/opt/products/dstar&#39; failed. (16)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>341
342
343
344
345
346
347
348</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#17 make directories: /opt/products/dstar/openssl-0.9.8d
mkdir /opt/products/dstar/openssl-0.9.8d
if [ $? != 0 ];then
	echo &quot;error:Make &#39;/opt/products/dstar/openssl-0.9.8d&#39; failed. (17)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>350
351
352
353
354
355
356
357</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#18 make directories: /opt/products/dstar/httpd-2.0.59
mkdir /opt/products/dstar/httpd-2.0.59
if [ $? != 0 ];then
	echo &quot;error:Make &#39;/opt/products/dstar/httpd-2.0.59&#39; failed. (18)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>359
360
361
362
363
364
365
366</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#19 change /opt/products/dstar owner and group
chown -R dstar.dstar /opt/products/dstar
if [ $? != 0 ];then
	echo &quot;error:Change &#39;/opt/products/dstar&#39; owner and group failed. (19)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>368
369
370
371
372
373
374
375</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#19.1 change permission /home/dstar/middle/jdk-1_5_0_09-linux-i586.bin
chmod 755 /home/dstar/middle/jdk-1_5_0_09-linux-i586.bin
if [ $? != 0 ];then
	echo &quot;error:Change &#39;/home/dstar/middle/jdk-1_5_0_09-linux-i586.bin&#39; access permissions failed. (19.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>377
378
379
380
381
382
383
384</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#20 copy home/dstar/middle/jdk-1_5_0_09-linux-i586.bin to /opt/products/dstar/
cp /home/dstar/middle/jdk-1_5_0_09-linux-i586.bin /opt/products/dstar/
if [ $? != 0 ];then
	echo &quot;error:Copy &#39;/home/dstar/middle/jdk-1_5_0_09-linux-i586.bin&#39; to &#39;/opt/products/dstar/&#39; failed. (20)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>386
387
388
389
390
391
392
393</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#21 copy /home/dstar/DDL to /home/postgres/
cp -pr /home/dstar/DDL /home/postgres/
if [ $? != 0 ];then
	echo &quot;error:Copy &#39;/home/dstar/DDL&#39; to &#39;/home/postgres/&#39; failed. (21)&quot;| tee -a ~/dstar_gw-install.log
	return 1;
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>395
396
397
398
399
400
401
402</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#22 change /home/postgres/DDL owner and group
chown -R postgres:postgres /home/postgres/DDL
if [ $? != 0 ];then
	echo &quot;error:Change &#39;/home/postgres/DDL&#39; owner and group failed. (22)&quot;| tee -a ~/dstar_gw-install.log
	return 1;
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>404
405
406
407
408
409
410
411</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#23 copy /home/dstar/apl/dstar_gw.tar.gz to /opt/products/dstar/
cp -pr /home/dstar/apl/dstar_gw.tar.gz /opt/products/dstar/
if [ $? != 0 ];then
	echo &quot;error:Copy &#39;/home/dstar/apl/dstar_gw.tar.gz&#39; to &#39;/opt/products/dstar/&#39; failed. (23)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>413
414</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ds_inst</span>
<span class="n">echo</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>415
416
417
418
419
420
421
422
423</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
#24 Expand files from /home/dstar/middle/openssl-0.9.8d.tar.gz
gunzip /home/dstar/middle/openssl-0.9.8d.tar.gz
if [ $? != 0 ];then
	echo &quot;error:Expand files from &#39;home/dstar/middle/openssl-0.9.8d.tar.gz&#39; failed. (24)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>425
426
427
428
429
430
431
432</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#24.1 Expand files from /home/dstar/middle/openssl-0.9.8d.tar to /home/dstar/middle/
tar -C /home/dstar/middle/ -xvf /home/dstar/middle/openssl-0.9.8d.tar
if [ $? != 0 ];then
	echo &quot;error:Extract files from &#39;home/dstar/middle/openssl-0.9.8d.tar&#39; to &#39;/home/dstar/middle/&#39; failed. (24.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>433
434
435
436
437
438
439
440
441</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
#25 change /home/dstar/middle/openssl-0.9.8d owner and group
chown -R dstar.dstar /home/dstar/middle/openssl-0.9.8d
if [ $? != 0 ];then
	echo &quot;error:Change &#39;/home/dstar/middle/openssl-0.9.8d&#39; owner and group failed. (25)&quot;| tee -a ~/dstar_gw-install.log
	return 1;
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>443
444
445
446
447
448
449
450</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#26 Expand files from /home/dstar/middle/apache-tomcat-5.5.20.tar.gz
gunzip /home/dstar/middle/apache-tomcat-5.5.20.tar.gz
if [ $? != 0 ];then
	echo &quot;error:Expand files from &#39;/home/dstar/middle/apache-tomcat-5.5.20.tar.gz&#39; failed. (26)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>452
453
454
455
456
457
458
459</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#26.1 Expand files from /home/dstar/middle/apache-tomcat-5.5.20.tar to /home/dstar/middle/
tar -C /home/dstar/middle/ -xvf /home/dstar/middle/apache-tomcat-5.5.20.tar
if [ $? != 0 ];then
	echo &quot;error:Extract files from &#39;home/dstar/middle/apache-tomcat-5.5.20.tar&#39; to &#39;/home/dstar/middle/&#39; failed. (26.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>461
462
463
464
465
466
467
468</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#27 Movw /home/dstar/middle/apache-tomcat-5.5.20 to /opt/products/dstar/
mv /home/dstar/middle/apache-tomcat-5.5.20 /opt/products/dstar/
if [ $? != 0 ];then
	echo &quot;error:Move &#39;/home/dstar/middle/apache-tomcat-5.5.20&#39; to &#39;/opt/products/dstar/&#39; failed. (27)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>470
471
472
473
474
475
476
477</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#28 change /opt/products/dstar/apache-tomcat-5.5.20 owner and group
chown -R dstar.dstar /opt/products/dstar/apache-tomcat-5.5.20
if [ $? != 0 ];then
	echo &quot;error:Change &#39;/opt/products/dstar/apache-tomcat-5.5.20&#39; owner and group failed. (28)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>479
480
481
482
483
484
485
486</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#29 Change the current directory to &#39;/opt/products/dstar/&#39;
cd /opt/products/dstar/
if [ $? != 0 ];then
	echo &quot;error:Change the current directory to &#39;/opt/products/dstar/&#39; failed. (29)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>488
489
490
491
492
493
494
495</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#29.1 Make symbolic link &#39;apache-tomcat-5.5.20&#39; to &#39;tomcat&#39;
ln -s apache-tomcat-5.5.20 tomcat
if [ $? != 0 ];then
	echo &quot;error:Make symbolic link &#39;apache-tomcat-5.5.20&#39; to &#39;tomcat&#39;&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>497
498
499
500
501
502
503
504</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#30 change /opt/products/dstar/tomcat owner and grouop
chown -R dstar.dstar /opt/products/dstar/tomcat
if [ $? != 0 ];then
	echo &quot;error:Change /opt/products/dstar/tomcat owner and group failed. (30)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>506
507
508
509
510
511
512
513</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#31 Expand files from /home/dstar/middle/httpd-2.0.59.tar.gz
gunzip /home/dstar/middle/httpd-2.0.59.tar.gz
if [ $? != 0 ];then
	echo &quot;error:Expand files from &#39;/home/dstar/middle/httpd-2.0.59.tar.gz&#39; failed. (31)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>515
516
517
518
519
520
521
522</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#31.1 Extract files from &#39;/home/dstar/middle/httpd-2.0.59.tar&#39; to &#39;/home/dstar/middle/&#39;
tar -C /home/dstar/middle/ -xvf /home/dstar/middle/httpd-2.0.59.tar
if [ $? != 0 ];then
	echo &quot;error:Extract files from &#39;/home/dstar/middle/httpd-2.0.59.tar&#39; to &#39;/home/dstar/middle/&#39; failed. (31.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>524
525
526
527
528
529
530
531</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#32 change &#39;/home/dstar/middle/httpd-2.0.59&#39; owner and group
chown -R dstar.dstar /home/dstar/middle/httpd-2.0.59
if [ $? != 0 ];then
	echo &quot;error:Failed to change &#39;/home/dstar/middle/httpd-2.0.59&#39; owner and group. (32)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>533
534
535
536
537
538
539
540</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#33 expand files from /home/dstar/middle/jakarta-tomcat-connectors-jk2-src-current.tar.gz
gunzip /home/dstar/middle/jakarta-tomcat-connectors-jk2-src-current.tar.gz
if [ $? != 0 ];then
	echo &quot;error:Failed to expand files from &#39;/home/dstar/middle/jakarta-tomcat-connectors-jk2-src-current.tar.gz&#39;. (33)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>542
543
544
545
546
547
548
549</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#33.1 extract files from &#39;/home/dstar/middle/jakarta-tomcat-connectors-jk2-src-current.tar&#39; to &#39;/home/dstar/middle/&#39;
tar -C /home/dstar/middle/ -xvf /home/dstar/middle/jakarta-tomcat-connectors-jk2-src-current.tar
if [ $? != 0 ];then
	echo &quot;error:Failed to extract files from &#39;/home/dstar/middle/jakarta-tomcat-connectors-jk2-src-current.tar&#39; to &#39;/home/dstar/middle/&#39;. (33.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>551
552
553
554
555
556
557
558</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#34 change &#39;/home/dstar/middle/jakarta-tomcat-connectors-jk2-2.0.4-src/&#39; owner and group
chown -R dstar.dstar /home/dstar/middle/jakarta-tomcat-connectors-jk2-2.0.4-src/
if [ $? != 0 ];then
	echo &quot;error:Failed to change &#39;/home/dstar/middle/jakarta-tomcat-connectors-jk2-2.0.4-src/&#39; owner and group. (34)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>560
561
562
563
564
565
566
567</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#35 extract files from &#39;/home/dstar/middle/postgresql-8.2.3.tar&#39; to &#39;/home/dstar/middle/&#39;
tar -C /home/dstar/middle/ -xvf  /home/dstar/middle/postgresql-8.2.3.tar
if [ $? != 0 ];then
	echo &quot;error:Failed to extract files from &#39;/home/dstar/middle/postgresql-8.2.3.tar&#39; to &#39;/home/dstar/middle/&#39;. (35)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>569
570
571
572
573
574
575
576</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#36 change &#39;/home/dstar/middle/postgresql-8.2.3&#39; owner and group
chown -R dstar.dstar /home/dstar/middle/postgresql-8.2.3
if [ $? != 0 ];then
	echo &quot;error:Failed to change &#39;/home/dstar/middle/postgresql-8.2.3&#39; owner and group. (36)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>578
579
580
581
582
583
584
585</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#37 Expand files from /opt/products/dstar/dstar_gw.tar.gz
gunzip /opt/products/dstar/dstar_gw.tar.gz
if [ $? != 0 ];then
	echo &quot;error:Failed to Expand files from &#39;/opt/products/dstar/dstar_gw.tar.gz&#39;. (37)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>587
588
589
590
591
592
593
594</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#37.1 extract files from &#39;/opt/products/dstar/dstar_gw.tar&#39; to &#39;/opt/products/dstar&#39;
tar -C /opt/products/dstar -xvf /opt/products/dstar/dstar_gw.tar
if [ $? != 0 ];then
	echo &quot;error:Failed to extract files from &#39;/opt/products/dstar/dstar_gw.tar&#39; to &#39;/opt/products/dstar&#39;. (37.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>596
597
598
599
600
601
602
603</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#38 change &#39;/opt/products/dstar/dstar_gw&#39; owner and group
chown -R dstar.dstar /opt/products/dstar/dstar_gw
if [ $? != 0 ];then
	echo &quot;error:Failed to change &#39;/opt/products/dstar/dstar_gw&#39; owner and group. (38)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>605
606
607
608
609
610
611
612</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#39 copy &#39;/home/dstar/middle/postgresql-8.2-504.jdbc3.jar&#39; to &#39;/opt/products/dstar/apache-tomcat-5.5.20/common/lib/&#39;
cp -pr /home/dstar/middle/postgresql-8.2-504.jdbc3.jar /opt/products/dstar/apache-tomcat-5.5.20/common/lib/
if [ $? != 0 ];then
	echo &quot;error:Failed to copy &#39;/home/dstar/middle/postgresql-8.2-504.jdbc3.jar&#39; to &#39;/opt/products/dstar/apache-tomcat-5.5.20/common/lib/&#39;&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>614
615
616
617
618
619
620
621</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#40 copy &#39;/home/dstar/apl/dstar_cgi.tar.gz&#39; to &#39;/opt/products/dstar/apache-tomcat-5.5.20/webapps/&#39;
cp -pr /home/dstar/apl/dstar_cgi.tar.gz /opt/products/dstar/apache-tomcat-5.5.20/webapps/
if [ $? != 0 ];then
	echo &quot;error:Failed to copy &#39;/home/dstar/apl/dstar_cgi.tar.gz&#39; to &#39;/opt/products/dstar/apache-tomcat-5.5.20/webapps/&#39;&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>623
624
625
626
627
628
629
630</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#41 Expand files from &#39;/opt/products/dstar/tomcat/webapps/dstar_cgi.tar.gz&#39;
gunzip /opt/products/dstar/tomcat/webapps/dstar_cgi.tar.gz
if [ $? != 0 ];then
	echo &quot;error:Failed to Expand files from &#39;/opt/products/dstar/tomcat/webapps/dstar_cgi.tar.gz&#39;. (41)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>631
632
633
634
635
636
637
638
639</pre></div></td><td class="code"><div class="highlight"><pre><span></span>
#41.1 extract files from &#39;/opt/products/dstar/tomcat/webapps/dstar_cgi.tar&#39; to &#39;/opt/products/dstar/tomcat/webapps/&#39;
tar -C /opt/products/dstar/tomcat/webapps/ -xvf /opt/products/dstar/tomcat/webapps/dstar_cgi.tar
if [ $? != 0 ];then
	echo &quot;error:error:Failed to extract files from &#39;/opt/products/dstar/tomcat/webapps/dstar_cgi.tar&#39; to &#39;/opt/products/dstar/tomcat/webapps/&#39;. (41.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>641
642
643
644
645
646
647
648</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#42 change &#39;/opt/products/dstar/tomcat/webapps/*&#39; owner and group
chown -R dstar.dstar /opt/products/dstar/tomcat/webapps/*
if [ $? != 0 ];then
	echo &quot;error:Failed to change &#39;/opt/products/dstar/tomcat/webapps/*&#39; owner and group. (42)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>650
651
652
653
654
655
656
657
658
659
660
661</pre></div></td><td class="code"><div class="highlight"><pre><span></span>###### step2 ###### user-dstar install
#43 execute jdk-1_5_0_09-linux-i586.bin
su - dstar -c&#39;
cd /opt/products/dstar/
./jdk-1_5_0_09-linux-i586.bin
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to jdk-1_5_0_09-linux-i586.bin. (43)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>663
664
665
666
667
668</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#44 delete &#39;/opt/products/dstar/jdk-1_5_0_09-linux-i586.bin&#39;
su - dstar -c &#39;rm -rf /opt/products/dstar/jdk-1_5_0_09-linux-i586.bin&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to remove &#39;/opt/products/dstar/jdk-1_5_0_09-linux-i586.bin&#39;. (44)&quot;| tee -a ~/dstar_gw-install.log
	return 1
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>670
671
672
673
674
675
676
677
678
679
680</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#45 make symbolic link &#39;/opt/products/dstar/jdk1.5.0_09&#39; to &#39;/opt/products/dstar/j2se&#39;
su - dstar -c &#39;
cd /opt/products/dstar/
ln -s jdk1.5.0_09 j2se
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to make symbolic link &#39;/opt/products/dstar/jdk1.5.0_09&#39; to &#39;/opt/products/dstar/j2se&#39;. (45)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>682
683
684
685
686
687
688
689
690
691
692</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#46 configuration openssl-install
su - dstar -c &#39;
cd /home/dstar/middle/openssl-0.9.8d/
./config --prefix=/opt/products/dstar/openssl-0.9.8d
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to &#39;config --prefix=/opt/products/dstar/openssl-0.9.8d&#39;. (46)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>694
695
696
697
698
699
700
701
702
703
704</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#47 make-openssl
su - dstar -c &#39;
cd /home/dstar/middle/openssl-0.9.8d/
make
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to make for openssl. (47)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>706
707
708
709
710
711
712
713
714
715
716</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#48 make install - openssl
su - dstar -c &#39;
cd /home/dstar/middle/openssl-0.9.8d/
make install
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to &#39;make install&#39; for openssl. (48)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>718
719
720
721
722
723
724
725
726
727
728</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#49 make symbolic link &#39;/opt/products/dstar/openssl-0.9.8d&#39; to &#39;/opt/products/dstar/open-ssl&#39;
su - dstar -c &#39;
cd /opt/products/dstar/
ln -s openssl-0.9.8d open-ssl
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to make symbolic link &#39;/opt/products/dstar/openssl-0.9.8d&#39; to &#39;/opt/products/dstar/open-ssl&#39;. (49)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>730
731
732
733
734
735
736
737
738
739
740</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#50 configuration httpd-install
su - dstar -c &#39;
cd /home/dstar/middle/httpd-2.0.59/
./configure --prefix=/opt/products/dstar/httpd-2.0.59 --enable-module=so --enable-ssl
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to &#39;./configure --prefix=/opt/products/dstar/httpd-2.0.59 --enable-module=so --enable-ssl&#39;. (50)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>742
743
744
745
746
747
748
749
750
751
752</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#51 make-httpd
su - dstar -c &#39;
cd /home/dstar/middle/httpd-2.0.59/
make
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to make for httpd. (51)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>754
755
756
757
758
759
760
761
762
763
764</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#52 make install - httpd
su - dstar -c &#39;
cd /home/dstar/middle/httpd-2.0.59/
make install
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to &#39;make install&#39; for httpd. (52)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>766
767
768
769
770
771
772
773
774
775
776</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#53 make symbolic link &#39;/opt/products/dstar/httpd-2.0.59&#39; to &#39;/opt/products/dstar/apache&#39;
su - dstar -c &#39;
cd /opt/products/dstar/
ln -s httpd-2.0.59 apache
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to make symbolic link &#39;/opt/products/dstar/httpd-2.0.59&#39; to &#39;/opt/products/dstar/apache&#39;. (53)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>778
779
780
781
782
783
784
785</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#54 copy &#39;/home/dstar/middle/sslkey/*&#39; to &#39;/opt/products/dstar/apache/conf/&#39;
su - dstar -c &#39;cp -pr /home/dstar/middle/sslkey/* /opt/products/dstar/apache/conf/&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to copy &#39;/home/dstar/middle/sslkey/*&#39; to &#39;/opt/products/dstar/apache/conf/&#39;. (54)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>787
788
789
790
791
792
793
794</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#55 copy &#39;/home/dstar/middle/dstarssl.conf&#39; to &#39;/opt/products/dstar/apache/conf/&#39;
su - dstar -c &#39;cp -p /home/dstar/middle/dstarssl.conf /opt/products/dstar/apache/conf/&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to copy &#39;/home/dstar/middle/dstarssl.conf&#39; to &#39;/opt/products/dstar/apache/conf/&#39;. (55)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>796
797
798
799
800
801
802
803</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#56 copy &#39;/opt/products/dstar/httpd-2.0.59/conf/httpd.conf&#39; to &#39;/opt/products/dstar/httpd-2.0.59/conf/httpd.conf.org&#39;
su - dstar -c &#39;cp /opt/products/dstar/httpd-2.0.59/conf/httpd.conf /opt/products/dstar/httpd-2.0.59/conf/httpd.conf.org&#39;
if [ $? != 0 ];then
	echo &quot;error:Faile to copy &#39;/opt/products/dstar/httpd-2.0.59/conf/httpd.conf&#39; to &#39;/opt/products/dstar/httpd-2.0.59/conf/httpd.conf.org&#39;. (56)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>805
806
807
808
809
810
811
812
813
814
815</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#57 configuration tomcat
su - dstar -c &#39;
cd /home/dstar/middle/jakarta-tomcat-connectors-jk2-2.0.4-src/jk/native2/
./configure --with-apxs2=/opt/products/dstar/apache/bin/apxs
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to &#39;./configure --with-apxs2=/opt/products/dstar/apache/bin/apxs&#39; for tomacat. (57)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>817
818
819
820
821
822
823
824
825
826
827</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#58 make tomcat
su - dstar -c &#39;
cd /home/dstar/middle/jakarta-tomcat-connectors-jk2-2.0.4-src/jk/native2/
make
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to make for tomacat. (58)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>829
830
831
832
833
834
835
836</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#59 copy &#39;/home/dstar/middle/jakarta-tomcat-connectors-jk2-2.0.4-src/jk/build/jk2/apache2/mod_jk2.so&#39; to &#39;/opt/products/dstar/httpd-2.0.59/modules/&#39;
su - dstar -c &#39;cp /home/dstar/middle/jakarta-tomcat-connectors-jk2-2.0.4-src/jk/build/jk2/apache2/mod_jk2.so /opt/products/dstar/httpd-2.0.59/modules/&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to copy &#39;/home/dstar/middle/jakarta-tomcat-connectors-jk2-2.0.4-src/jk/build/jk2/apache2/mod_jk2.so&#39; to &#39;/opt/products/dstar/httpd-2.0.59/modules/&#39;. (59)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>838
839
840
841
842
843
844
845</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#60 copy &#39;/home/dstar/middle/workers2.properties&#39; to &#39;/opt/products/dstar/httpd-2.0.59/conf/
su - dstar -c &#39;cp /home/dstar/middle/workers2.properties /opt/products/dstar/httpd-2.0.59/conf/&#39;
if [ $? != 0 ];then
	echo &quot;error:Faled to copy &#39;/home/dstar/middle/workers2.properties&#39; to &#39;/opt/products/dstar/httpd-2.0.59/conf/&#39;. (60)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>847
848
849
850
851
852
853
854
855
856
857</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#61 configuration postgresql-install
su - dstar -c &#39;
cd /home/dstar/middle/postgresql-8.2.3/
./configure --prefix=/opt/products/dstar/pgsql-8.2.3 --enable-thread-safety --without-readline --without-zlib
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to &#39;./configure --prefix=/opt/products/dstar/pgsql-8.2.3 --enable-thread-safety --without-readline --without-zlib&#39; for pgsql. (61)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>859
860
861
862
863
864
865
866
867
868
869</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#62 gmake postgresql 
su - dstar -c &#39;
cd /home/dstar/middle/postgresql-8.2.3/
gmake
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to gmake for postgresql. (62)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>871
872
873
874
875
876
877
878
879</pre></div></td><td class="code"><div class="highlight"><pre><span></span>###### step3 ###### configuration
#62.1 edit &#39;/var/spool/cron/root&#39;
cat /opt/products/dstar/dstar_gw/cron/root.cron &gt;&gt; /var/spool/cron/root
if [ $? != 0 ];then
	echo &quot;error:Failed to edit &#39;/var/spool/cron/root&#39;. (62.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>881
882
883
884
885
886
887
888</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#62.2 edit &#39;/var/spool/cron/postgres&#39;
cat /opt/products/dstar/dstar_gw/cron/postgres.cron &gt;&gt; /var/spool/cron/postgres
if [ $? != 0 ];then
	echo &quot;error:Failed to edit &#39;/var/spool/cron/postgres&#39;. (62.2)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>890
891
892
893
894
895
896
897</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#62.3 copy &#39;/etc/syslog.conf&#39; to &#39;/etc/syslog.conf.old&#39;
cp /etc/syslog.conf /etc/syslog.conf.old
if [ $? != 0 ];then
	echo &quot;error:Failed to copy &#39;/etc/syslog.conf&#39; to &#39;/etc/syslog.conf.old&#39;. (62.3)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>899
900
901
902
903
904
905
906</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#62.4 edit &#39;/etc/syslog.conf&#39;
cat /tmp/dsinst/syslog.conf.set | tee -a /etc/syslog.conf
if [ $? != 0 ];then
	echo &quot;error:Failed to edit &#39;/etc/syslog.conf&#39;. (62.4)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>908
909
910
911
912
913
914
915</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#62.5 move &#39;/etc/sysconfig/syslog&#39; to &#39;/etc/sysconfig/syslog.old&#39;
mv /etc/sysconfig/syslog /etc/sysconfig/syslog.old
if [ $? != 0 ];then
	echo &quot;error:Failed to move &#39;/etc/sysconfig/syslog&#39; to &#39;/etc/sysconfig/syslog.old&#39;. (62.5)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>917
918
919
920
921
922
923
924</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#62.6 edit &#39;/etc/sysconfig/syslog&#39;
sed -e s/&#39;SYSLOGD_OPTIONS=&quot;&#39;/&#39;SYSLOGD_OPTIONS=&quot;-r &#39;/ /etc/sysconfig/syslog.old &gt;&gt; /etc/sysconfig/syslog
if [ $? != 0 ];then
	echo &quot;error:Failed to edit &#39;/etc/sysconfig/syslog&#39;. (62.6)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>926
927
928
929
930
931
932
933</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#62.7 restart &#39;service syslog&#39;
	service syslog restart
	if [ $? != 0 ]
	then
		echo &quot;error:Failed to restart &#39;service syslog&#39;. (62.7)&quot;| tee -a ~/dstar_gw-install.log
	else
		true
	fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>935
936
937
938
939
940
941
942</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#62.7 make directories &#39;/opt/products/dstar/apache/securesite&#39;
mkdir /opt/products/dstar/apache/securesite
if [ $? != 0 ];then
	echo &quot;error:Failed to make directories &#39;/opt/products/dstar/apache/securesite&#39;. (62.7)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>944
945
946
947
948
949
950
951</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#62.8 change &#39;/opt/products/dstar/apache/securesite&#39; ouner and group
chown -R dstar.dstar /opt/products/dstar/apache/securesite
if [ $? != 0 ];then
	echo &quot;error:Failed to change &#39;/opt/products/dstar/apache/securesite&#39; ouner and group. (62.8)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>953
954
955
956
957
958
959
960</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#63 change the current directory to &#39;/home/dstar/middle/postgresql-8.2.3/&#39;
cd /home/dstar/middle/postgresql-8.2.3/
if [ $? != 0 ];then
	echo &quot;error:Failed to change the current directory to &#39;/home/dstar/middle/postgresql-8.2.3/&#39;. (63)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>962
963
964
965
966
967
968
969</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#64 gmake install
gmake install
if [ $? != 0 ];then
	echo &quot;error:Failed to &#39;gmake install&#39;&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>971
972
973
974
975
976
977
978</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#65 make directories &#39;/opt/products/dstar/pgsql-8.2.3/data&#39;
mkdir /opt/products/dstar/pgsql-8.2.3/data
if [ $? != 0 ];then
	echo &quot;error:Failed to make directories &#39;/opt/products/dstar/pgsql-8.2.3/data&#39;. (65)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>980
981
982
983
984
985
986
987</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#65.1 change the current directory to &#39;/opt/products/dstar/&#39;
cd /opt/products/dstar/
if [ $? != 0 ];then
	echo &quot;error:Failed to change the current directory to &#39;/opt/products/dstar/&#39;. (65.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>989
990
991
992
993
994
995
996</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#66 make symbolic link &#39;pgsql-8.2.3&#39; to &#39;pgsql&#39;
ln -s pgsql-8.2.3 pgsql
if [ $? != 0 ];then
	echo &quot;error:Failed to make symbolic link &#39;pgsql-8.2.3&#39; to &#39;pgsql&#39;&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 998
 999
1000
1001
1002
1003
1004
1005</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#67 change &#39;/opt/products/dstar/pgsql-8.2.3&#39; owner and group
chown -R postgres:postgres /opt/products/dstar/pgsql-8.2.3
if [ $? != 0 ];then
	echo &quot;error:Failed to change &#39;/opt/products/dstar/pgsql-8.2.3&#39; owner and group. (67)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1007
1008
1009
1010
1011
1012
1013
1014</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#67.1 copy &#39;/opt/products/dstar/tomcat/conf/server.xml&#39; to &#39;/opt/products/dstar/tomcat/conf/server.xml.old&#39;
cp /opt/products/dstar/tomcat/conf/server.xml /opt/products/dstar/tomcat/conf/server.xml.old
if [ $? != 0 ];then
	echo &quot;error:Failed to copy &#39;/opt/products/dstar/tomcat/conf/server.xml&#39; to &#39;/opt/products/dstar/tomcat/conf/server.xml.old&#39;. (67.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1016
1017
1018
1019
1020
1021
1022
1023</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#68 copy &#39;/tmp/dsinst/server.xml&#39; to &#39;/opt/products/dstar/tomcat/conf/
cp /tmp/dsinst/server.xml /opt/products/dstar/tomcat/conf/
if [ $? != 0 ];then
	echo &quot;error:Failed to copy &#39;/tmp/dsinst/server.xml&#39; to &#39;/opt/products/dstar/tomcat/conf/&#39; (68)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1025
1026
1027
1028
1029
1030
1031
1032</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#68.1 Change &#39;/opt/products/dstar/tomcat/conf/server.xml&#39; access permissions
chmod 600 /opt/products/dstar/tomcat/conf/server.xml
if [ $? != 0 ];then
	echo &quot;error:Failed to Change &#39;/opt/products/dstar/tomcat/conf/server.xml&#39; access permissions failed. (68.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1035
1036
1037
1038
1039
1040
1041
1042</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#69 copy&#39;/tmp/dsinst/httpd.conf&#39; to &#39;/opt/products/dstar/apache/conf/&#39;
cp /tmp/dsinst/httpd.conf /opt/products/dstar/apache/conf/
if [ $? != 0 ];then
	echo &quot;error:Failed ot copy&#39;/tmp/dsinst/httpd.conf&#39; to &#39;/opt/products/dstar/apache/conf/&#39;. (69)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1044
1045
1046
1047
1048
1049
1050
1051</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#69.1 Change &#39;/opt/products/dstar/apache/conf/httpd.conf&#39; access permissions
chmod 644 /opt/products/dstar/apache/conf/httpd.conf
if [ $? != 0 ];then
	echo &quot;error:Failed to Change &#39;/opt/products/dstar/apache/conf/httpd.conf&#39; access permissions failed. (69.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1053
1054
1055
1056
1057
1058
1059
1060</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#69.5 copy &#39;dstar_gw&#39; to &#39;/etc/init.d&#39;
cp /tmp/dsinst/dstar_gw /etc/init.d
if [ $? != 0 ];then
	echo &quot;error:Failed to copy &#39;dstar_gw&#39; to &#39;/etc/init.d&#39; (69.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1062
1063
1064
1065
1066
1067
1068
1069</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#69.6 change &#39;/etc/init.d/dstar_gw&#39; access permissions
chmod 755 /etc/init.d/dstar_gw
if [ $? != 0 ];then
	echo &quot;error:Failed to change &#39;/etc/init.d/dstar_gw&#39; access permissions failed. (69.6)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1071
1072
1073
1074
1075
1076
1077
1078</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#69.7 add new service &#39;dstar_gw&#39;
chkconfig --add dstar_gw
if [ $? != 0 ];then
	echo &quot;error:Failed to &#39;chkconfig --add dstar_gw&#39; (69.2)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1080
1081
1082
1083
1084
1085
1086
1087</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#69.8 specifies the run levels dstar_gw
chkconfig --level 2345 dstar_gw on
if [ $? != 0 ];then
	echo &quot;error:Failed to &#39;chkconfig --level 2345 dstar_gw on&#39; (69.3)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1089
1090
1091
1092
1093
1094
1095
1096
1097
1098</pre></div></td><td class="code"><div class="highlight"><pre><span></span>###### step4 ###### user-postgres install
#70 create a new PostgreSQL database cluster
su - postgres -c &#39;/opt/products/dstar/pgsql/bin/initdb -D /opt/products/dstar/pgsql/data&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to &#39;/opt/products/dstar/pgsql/bin/initdb -D /opt/products/dstar/pgsql/data&#39;. (70)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
sleep 2
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1100
1101
1102
1103
1104
1105
1106
1107</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#70.1 Backup postgresql.conf
su - postgres -c &#39;mv /opt/products/dstar/pgsql/data/postgresql.conf /opt/products/dstar/pgsql/data/postgresql.conf.old&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to backup postgresql.conf. (75.1)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1109
1110
1111
1112
1113
1114
1115
1116</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#70.2 Edit postgresql.crof
sed &#39;s/#timezone = unknown/timezone = UTC/g&#39; /opt/products/dstar/pgsql/data/postgresql.conf.old &gt; /opt/products/dstar/pgsql/data/postgresql.conf
if [ $? != 0 ];then
	echo &quot;error:Failed to backup postgresql.conf. (75.2)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1118
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#71 start PostgreSQL
su - postgres -c &#39;/opt/products/dstar/pgsql/bin/postgres -D /opt/products/dstar/pgsql/data &gt;logfile 2&gt;&amp;1 &amp; true&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to &#39;/opt/products/dstar/pgsql/bin/postgres -D /opt/products/dstar/pgsql/data &gt;logfile 2&gt;&amp;1 &amp;&#39;. (71)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi

mktemp -q /tmp/ds_inst 1&gt;/dev/null
/tmp/dsinst/disp.sh &amp;

sleep 2
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1132
1133
1134
1135
1136
1137
1138
1139
1140
1141
1142
1143
1144
1145
1146
1147
1148
1149
1150</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#72 create a new PostgreSQL database &#39;dstar_global&#39;
su - postgres -c &#39;/opt/products/dstar/pgsql/bin/createdb dstar_global&#39;
ExVal=$?
i=0
while [ ${ExVal} != 0 ];
do
	echo &quot;retry &quot;$i&quot; (&lt;10)&quot;
	$(( $i + 1 ))
	if [ $i -ge 10 ];then
		echo &quot;error:Failed to create databese &#39;dstar_global&#39;. (72)&quot;| tee -a ~/dstar_gw-install.log
		return 1
	fi
	sleep 2
	su - postgres -c &#39;/opt/products/dstar/pgsql/bin/createdb dstar_global&#39;
	ExVal=$?
done

rm -f /tmp/ds_inst
echo
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1159
1160
1161
1162
1163
1164
1165
1166</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#73 define a new PostgreSQL user account
su - postgres -c &#39;/opt/products/dstar/pgsql/bin/createuser dstar&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to create a new PostgreSQL role. (73)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1161
1162
1163
1164
1165
1166
1167
1168</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#74 create password
su - postgres -c &#39;cat /tmp/dsinst/pgsql.sql | psql -U dstar dstar_global&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to &#39;cat /tmp/dsinst/pgsql.sql | psql -U dstar dstar_global&#39;. (74)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1170
1171
1172
1173
1174
1175
1176
1177
1178
1179
1180
1181
1182</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#75 create database tables
su - postgres -c &#39;
cd /home/postgres/DDL
cat *.sql | psql -U dstar dstar_global
&#39;
if [ $? != 0 ];then
	echo &quot;error:Failed to create database tables. (75)&quot;| tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi

}
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1184
1185
1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196
1197
1198
1199
1200
1201
1202
1203
1204
1205
1206
1207
1208
1209
1210
1211
1212
1213
1214
1215
1216
1217
1218
1219
1220
1221
1222
1223
1224
1225
1226
1227
1228
1229
1230</pre></div></td><td class="code"><div class="highlight"><pre><span></span>###### uninstall ######

uninstall(){
#76 delete user &#39;dstar&#39;
	if [ `id dstar 2&gt;/dev/null | wc -l` != 0 ];then
		echo &quot;delete user &#39;dstar&#39;? (Y/n) &quot;
		read ans
		case ${ans} in
			[yY])	mktemp -q /tmp/ds_inst 1&gt;/dev/null
					/tmp/dsinst/disp.sh &amp;
					DATE=`date +&quot;%y%m%d_%H%M%S&quot;`
					cd /home
					tar cfvz dstar.$DATE.tar.gz dstar
					cd -
					userdel -r dstar
					rm -f /tmp/ds_inst
					echo
					if [ $? != 0 ];then
						echo &quot;error:Failed to userdel dstar failed. (76)&quot;| tee -a ~/dstar_gw-install.log
					else
						true
					fi
					;;
			*)		;;
		esac
		ans=&quot;&quot;
	else
		true
	fi

#77 delete user &#39;postgres&#39;
	if [ `id postgres 2&gt;/dev/null | wc -l` != 0 ];then
		echo &quot;delete user &#39;postgres&#39;? (Y/n) &quot;
		read ans
		case ${ans} in
			[yY])	mktemp -q /tmp/ds_inst 1&gt;/dev/null
					/tmp/dsinst/disp.sh &amp;
					DATE=`date +&quot;%y%m%d_%H%M%S&quot;`
					cd /home
					tar cfvz postgres.$DATE.tar.gz postgres
					cd -
					userdel -r postgres
					rm -f /tmp/ds_inst
					echo
					if [ $? != 0 ];then
						echo &quot;error:Failed to userdel postgres failed. (77)&quot;| tee -a ~/dstar_gw-install.log
					else
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1241
1242
1243
1244
1245
1246
1247
1248
1249
1250
1251
1252
1253
1254
1255
1256
1257
1258
1259</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#78 roll back &#39;~/.bashrc&#39;
#   use backup-file(made at install)
	if [ -f ~/.bashrc.old ];then
		echo &quot;roll back &#39;.bashrc&#39;? (Y/n) &quot;
		read ans
		case ${ans} in
			[yY])	cp ~/.bashrc.old ~/.bashrc
					if [ $? != 0 ];then
						echo &quot;error:Failed to roll back &#39;~/.bashrc&#39;. (78)&quot;| tee -a ~/dstar_gw-install.log
					else
						true
					fi
					;;
			*)		;;
		esac
		ans=&quot;&quot;
	else
		true
	fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1261
1262
1263
1264
1265
1266
1267
1268
1269
1270
1271
1272
1273
1274
1275
1276
1277
1278
1279</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#79 roll back &#39;syslog.conf&#39;
#   use backup-file(made at install)
	if [ -f /etc/syslog.conf.old ];then
		echo &quot;roll back &#39;syslog.conf&#39;? (Y/n) &quot;
		read ans
		case ${ans} in
			[yY])	cp /etc/syslog.conf.old /etc/syslog.conf
					if [ $? != 0 ];then
						echo &quot;error:Failed to roll back &#39;/etc/syslog.conf&#39;. (79)&quot;| tee -a ~/dstar_gw-install.log
					else
						true
					fi
					;;
			*)		;;
		esac
		ans=&quot;&quot;
	else
		true
	fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1281
1282
1283
1284
1285
1286
1287
1288
1289
1290
1291
1292
1293
1294
1295
1296
1297
1298
1299</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#80 roll back &#39;syslog&#39;
#   use backup-file(made at install)
	if [ -f /etc/sysconfig/syslog.old ];then
		echo &quot;roll back &#39;syslog&#39;? (Y/n) &quot;
		read ans
		case ${ans} in
			[yY])	cp /etc/sysconfig/syslog.old /etc/sysconfig/syslog
					if [ $? != 0 ];then
						echo &quot;error:roll back &#39;/etc/sysconfig/syslog&#39;. (80)&quot;| tee -a ~/dstar_gw-install.log
					else
						true
					fi
					;;
			*)		;;
		esac
		ans=&quot;&quot;
	else
		true
	fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1301
1302
1303
1304
1305
1306
1307
1308
1309
1310
1311</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#81 removed service &#39;dstar_gw&#39;
	if [ -f /etc/init.d/dstar_gw ];then
		chkconfig --del dstar_gw
		if [ $? != 0 ];then
			echo &quot;error:failed to &#39;chkconfig --del dstar_gw&#39;. (81)&quot;| tee -a ~/dstar_gw-install.log
		else
			true
		fi
	else
		true
	fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1313
1314
1315
1316
1317
1318
1319
1320
1321
1322
1323</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#82 remove &#39;/etc/init.d/dstar_gw&#39;
	if [ -f /etc/init.d/dstar_gw ];then
		rm -f /etc/init.d/dstar_gw
		if [ $? != 0 ];then
			echo &quot;error:failed to remove &#39;/etc/init.d/dstar_gw&#39;. (82)&quot;| tee -a ~/dstar_gw-install.log
		else
			true
		fi
	else
		true
	fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1325
1326
1327
1328
1329
1330
1331
1332
1333
1334
1335
1336
1337
1338
1339
1340
1341
1342
1343
1344
1345
1346
1347</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#83 remove &#39;/opt/products&#39;
	if [ -d /opt/products ];then
		echo &quot;delete &#39;install_directory(/opt/products)&#39;? (Y/n) &quot;
		read ans
		case ${ans} in
			[yY])	mktemp -q /tmp/ds_inst 1&gt;/dev/null
					/tmp/dsinst/disp.sh &amp;
					rm -r /opt/products
					rm -f /tmp/ds_inst
					echo
					if [ $? != 0 ];then
						echo &quot;error:Failed to remove &#39;/opt/products&#39;. (83)&quot;| tee -a ~/dstar_gw-install.log
					else
						true
					fi
					;;
			*)		;;
		esac
		ans=&quot;&quot;
	else
		true
	fi
}
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1350
1351
1352
1353</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">###### check() ######</span>
<span class="n">check</span><span class="p">()</span>
<span class="p">{</span>
<span class="c1">### 環境チェック ###</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1355
1356
1357
1358
1359
1360
1361</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#84 whoami
if [ `whoami` != &#39;root&#39; ];then
	echo &quot;error: not root (84)&quot; | tee -a ~/dstar_gw-install.log
	return 1
else
	true	
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1363
1364
1365
1366
1367
1368</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1">#84.1 remove /tmp/ds_inst</span>
<span class="k">if</span> <span class="p">[</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ds_inst</span> <span class="p">];</span><span class="n">then</span>
	<span class="n">rm</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">ds_inst</span>
<span class="k">else</span>
	<span class="n">true</span>
<span class="n">fi</span>
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1370
1371
1372
1373
1374
1375
1376
1377
1378
1379
1380
1381</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#84.2 emove temporary files&#39;/tmp/dsinst&#39;
if [ -d /tmp/dsinst ];
then
	rm -rf /tmp/dsinst
	if [ $? != 0 ];then
		echo &quot;error:Failed to remove temporary files (84.2)&quot;| tee -a ~/dstar_gw-install.log
	else
		true
	fi
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1383
1384
1385
1386
1387
1388
1389</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#84.3 copy &#39;./dsinst.tar.gz&#39; to &#39;/tmp&#39;
cp dsinst.tar.gz /tmp
if [ $? != 0 ];then
	echo &quot;error:Failed to copy &#39;./dsinst.tar.gz&#39; to &#39;/tmp&#39; (84.3)&quot;| tee -a ~/dstar_gw-install.log
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1391
1392
1393
1394
1395
1396
1397</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#84.4 expand files from /tmp/dsinst.tar.gz
gunzip /tmp/dsinst.tar.gz
if [ $? != 0 ];then
	echo &quot;error:Failed to expand files from /tmp/dsinst.tar.gz (84.4)&quot;| tee -a ~/dstar_gw-install.log
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1399
1400
1401
1402
1403
1404
1405</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#84.5 xpand files from /tmp/dsinst.tar
tar -C /tmp -xvf /tmp/dsinst.tar 1&gt;/dev/null
if [ $? != 0 ];then
	echo &quot;error:Failed to expand files from /tmp/dsinst.tar (84.5)&quot;| tee -a ~/dstar_gw-install.log
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1407
1408
1409
1410
1411
1412
1413</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#84.6 remove /tmp/dsinst.tar
rm -f /tmp/dsinst.tar
if [ $? != 0 ];then
	echo &quot;error:Failed to remove /tmp/dsinst.tar (84.6)&quot;| tee -a ~/dstar_gw-install.log
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1415
1416
1417
1418
1419
1420
1421
1422</pre></div></td><td class="code"><div class="highlight"><pre><span></span>## file-check
#85 root.bashrc
if [ ! -f /tmp/dsinst/root.bashrc ];then
	echo &quot;error: not found /tmp/dsinst/root.bashrc (85)&quot; | tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1424
1425
1426
1427
1428
1429
1430</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#86 dstar.bashrc
if [ ! -f /tmp/dsinst/dstar.bashrc ];then
	echo &quot;error: not found /tmp/dsinst/dstar.bashrc (86)&quot; | tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1432
1433
1434
1435
1436
1437
1438</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#87 postgres.bashrc
if [ ! -f /tmp/dsinst/postgres.bashrc ];then
	echo &quot;error: not found /tmp/dsinst/postgres.bashrc (87)&quot; | tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1440
1441
1442
1443
1444
1445
1446</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#88 httpd.conf
if [ ! -f /tmp/dsinst/httpd.conf ];then
	echo &quot;error: not found /tmp/dsinst/httpd.conf (88)&quot; | tee -a ~/dstar_gw-install.log
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1448
1449
1450
1451
1452</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#89 pgsql.sql
if [ ! -f /tmp/dsinst/pgsql.sql ];then
	echo &quot;error: not found /tmp/dsinst/pgsql.sql (89)&quot; | tee -a ~/dstar_gw-install.log
	return 1
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1454
1455
1456
1457
1458</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#90 dstar_gw
if [ ! -f /tmp/dsinst/dstar_gw ];then
	echo &quot;eerror: not found /tmp/dsinst/dstar_gw (90)&quot; | tee -a ~/dstar_gw-install.log
	return 1
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1460
1461
1462
1463
1464</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#91 server.xml
if [ ! -f /tmp/dsinst/server.xml ];then
	echo &quot;eerror: not found /tmp/dsinst/server.xml (91)&quot; | tee -a ~/dstar_gw-install.log
	return 1
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1466
1467
1468
1469
1470</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#92 syslog.conf.set
if [ ! -f /tmp/dsinst/syslog.conf.set ];then
	echo &quot;eerror: not found /tmp/dsinst/syslog.conf.set (92)&quot; | tee -a ~/dstar_gw-install.log
	return 1
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1472
1473
1474
1475
1476
1477</pre></div></td><td class="code"><div class="highlight"><pre><span></span>## check gcc
#93 gcc is not installed -&gt; exit
if [ `rpm -q gcc | grep gcc-[34] | wc -l` = 0 ];then
	echo &quot;*** gcc is not installed *** (93)&quot;  | tee -a ~/dstar_gw-install.log
	return 1
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1479
1480
1481
1482
1483</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#94 gcc-c++ is not installed -&gt; exit
if [ `rpm -q gcc-c++ | grep gcc-c++-[34] | wc -l` = 0 ];then
	echo &quot;*** gcc is not installed *** (94)&quot;  | tee -a ~/dstar_gw-install.log
	return 1
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1485
1486
1487
1488
1489
1490
1491</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#94.1 check DNS-server
if [ ! -d /var/named ];then
	echo &quot;Please install &#39;DNS server&#39; (94.1)&quot;
	return 1
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1493
1494
1495
1496
1497
1498
1499
1500
1501
1502
1503
1504
1505
1506
1507
1508
1509</pre></div></td><td class="code"><div class="highlight"><pre><span></span>## chekck process
#95 chekck process &#39;dsipsvd&#39;
#   is running -&gt; stop process
if [ `ps -aef | grep dsipsvd | grep -v ipchk.sh | grep -v grep | wc -l` != 0 ];then
	echo &quot;*** dsispd is running. *** (95-1)&quot; | tee -a ~/dstar_gw-install.log
	echo &quot;Do you want to stop? (Y/n)&quot;
	read ans
	case ${ans} in
		[yY])	/tmp/dsinst/dstar_gw stop 1&gt;/dev/null
				;;
		*)		;;
	esac
	if [ `ps -aef | grep dsipsvd | grep -v ipchk.sh | grep -v grep | wc -l` != 0 ];then
		echo &quot;*** Failed to stop dsispd. *** (95-2)&quot; | tee -a ~/dstar_gw-install.log
		return 1
	fi
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1511
1512
1513
1514
1515
1516
1517
1518
1519
1520
1521
1522
1523
1524
1525
1526</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#96 chekck process &#39;dsgwd&#39;
#   is running -&gt; stop process
if [ `pgrep dsgwd | wc -l` != 0 ];then
	echo &quot;*** GW server(dsgwd) is running *** (96-1)&quot; | tee -a ~/dstar_gw-install.log
	echo &quot;Do you want to stop? (Y/n)&quot;
	read ans
	case ${ans} in
		[yY])	/tmp/dsinst/dstar_gw stop 1&gt;/dev/null
				;;
		*)		;;
	esac
	if [ `pgrep dsgwd | wc -l` != 0 ];then
		echo &quot;*** Failed to stop &#39;GW server&#39;(dsgwd). *** (96-2)&quot; | tee -a ~/dstar_gw-install.log
		return 1
	fi
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1528
1529
1530
1531
1532
1533
1534
1535
1536
1537
1538
1539
1540
1541
1542
1543</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#97 chekck process &#39;httpd&#39;
#   is running -&gt; stop process
if [ `ps -aef | grep /opt/products/dstar/httpd-2.0.59/bin/httpd | grep -v grep | wc -l` != 0 ];then
	echo &quot;*** Apache(httpd) is running. *** (97-1)&quot; | tee -a ~/dstar_gw-install.log
	echo &quot;Do you want to stop? (Y/n)&quot;
	read ans
	case ${ans} in
		[yY])	/tmp/dsinst/dstar_gw stop 1&gt;/dev/null
				;;
		*)		;;
	esac
	if [ `pgrep -U dstar httpd | wc -l` != 0 ];then
		echo &quot;*** Failed to stop Apache(httpd). *** (97-2)&quot; | tee -a ~/dstar_gw-install.log
		return 1
	fi
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1546
1547
1548
1549
1550
1551
1552
1553
1554
1555
1556
1557
1558
1559
1560
1561</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#98 chekck process &#39;tomcat&#39;
#   is running -&gt; stop process
if [ `ps -aef | grep tomcat | grep -v grep | wc -l` != 0 ];then
	echo &quot;*** tomcat is running. *** (98-1)&quot; | tee -a ~/dstar_gw-install.log
	echo &quot;Do you want to stop? (Y/n)&quot;
	read ans
	case ${ans} in
		[yY])	/tmp/dsinst/dstar_gw stop 1&gt;/dev/null
				;;
		*)		;;
	esac
	if [ `ps -aef | grep tomcat | grep -v grep | wc -l` != 0 ];then
		echo &quot;*** Failed to stop tomcat. *** (98-2)&quot; | tee -a ~/dstar_gw-install.log
		return 1
	fi
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1563
1564
1565
1566
1567
1568
1569
1570
1571
1572
1573
1574
1575
1576
1577
1578
1579
1580
1581
1582
1583</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#99 find postgres-user
if [ `id postgres 2&gt;/dev/null | wc -l` != 0 ];then
#   chekck process &#39;PostgreSQL&#39;
#   is running -&gt; stop process
	if [ `ps -U postgres | grep postgres | wc -l` != 0 ];then
		echo &quot;*** PostgreSQL is running. *** (99-1)&quot; | tee -a ~/dstar_gw-install.log
		echo &quot;Do you want to stop? (Y/n)&quot;
		read ans
		case ${ans} in
			[yY])	/tmp/dsinst/dstar_gw stop 1&gt;/dev/null
					;;
			*)		;;
		esac
		if [ `ps -U postgres | grep postgres | wc -l` != 0 ];then
			echo &quot;*** Failed to stop PostgreSQL. *** (99-2)&quot; | tee -a ~/dstar_gw-install.log
			return 1
		fi
	fi
fi

}
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1585
1586
1587
1588
1589
1590
1591
1592
1593
1594</pre></div></td><td class="code"><div class="highlight"><pre><span></span>###### main() ######

##start check
check
if [ $? != 0 ];then
	echo &quot;*** install failed. *** (100.1)&quot; | tee -a ~/dstar_gw-install.log
	exit
else
	true
fi
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1597
1598
1599
1600
1601
1602
1603
1604
1605
1606
1607
1608
1609
1610
1611
1612
1613
1614
1615
1616
1617
1618
1619
1620
1621
1622
1623
1624
1625
1626
1627
1628
1629
1630
1631
1632
1633
1634
1635
1636
1637
1638
1639
1640
1641
1642
1643
1644
1645
1646
1647
1648
1649
1650
1651
1652
1653
1654</pre></div></td><td class="code"><div class="highlight"><pre><span></span>###101-105 Option ###

case $1 in
	uninstall)	echo &quot;Do you really want to uninstall? (Y/n)&quot;
				read ans
				case ${ans} in
					[yY])	uninstall
							echo &quot;*** uninstall successfully finished. ***&quot;;;
					*)	;;	
				esac
				;;
	install)	install
				if [ $? != 0 ];then
					echo &quot;*** install failed. *** (101)&quot; | tee -a ~/dstar_gw-install.log
					pkill postgres
					echo &quot;Do you want to uninstall? (Y/n)&quot;
					read ans
					case ${ans} in
						[yY])	uninstall;;
						*)	;;	
					esac
				else
					echo &quot;*** install successfully finished. *** (102)&quot; | tee -a ~/dstar_gw-install.log
					echo &quot;Do you want to append an administrator? (Y/n)&quot;
					read ans
					case ${ans} in
						[yY])	add_user_mng.sh;;
						*)	;;	
					esac
					pkill postgres
					echo &quot;Please edit &#39;GW server&#39; conf&quot;
				fi
				;;
	&quot;&quot;)			install
				if [ $? != 0 ];then
					echo &quot;*** install failed. *** (103)&quot; | tee -a ~/dstar_gw-install.log
					pkill postgres
					echo &quot;Do you want to uninstall? (Y/n)&quot;
					read ans
					case ${ans} in
						[yY])	uninstall;;
						*)	;;	
					esac
				else
					echo &quot;*** install successfully finished. *** (104)&quot; | tee -a ~/dstar_gw-install.log
					pkill postgres
					echo
					echo
					echo &quot;*******************************************&quot;
					echo &quot;*******Please edit &#39;GW server&#39; conf.*******&quot;
					echo &quot;*******************************************&quot;
					echo
					echo
				fi
				;;
	*)			echo &quot;invalid argument to option (105)&quot; | tee -a ~/dstar_gw-install.log
				;;
esac
</pre></div>
</td></tr></table></div>
<div class="highlight-default"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1657
1658
1659
1660
1661
1662
1663
1664
1665
1666
1667
1668</pre></div></td><td class="code"><div class="highlight"><pre><span></span>#106 delete temporary files
if [ -d /tmp/dsinst ];
then
	rm -rf /tmp/dsinst
	if [ $? != 0 ];then
		echo &quot;error:Failed to remove temporary files (106)&quot;| tee -a ~/dstar_gw-install.log
	else
		true
	fi
else
	true
fi
</pre></div>
</td></tr></table></div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Protocol/Packets.html" class="btn btn-neutral float-right" title="Voice and Data Packets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../GatewayServer/DNSInstall.html" class="btn btn-neutral" title="Gateway DNS Setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Roie R. Black.
      Last updated on Oct 24, 2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>